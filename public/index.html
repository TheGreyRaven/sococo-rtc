<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="Sococo.RTC">
   <meta name="author" content="Social Communications Company">
   <title>Sococo RTC Playground</title>
   <link href="./app/sococo-rtc.min.css" rel="stylesheet">
<body ng-app ng-controller="AppController">

<div class="masthead">
   <div class="inner clearfix">
      <div class="masthead-brand">
         <h2>Sococo.RTC</h2>
      </div>
      <ul class="controls">
         <li><a class="srtc-volume" href="#" ng-click="toggleListen()" ng-class="{active:listen}"></a></li>
         <li><a class="srtc-microphone" href="#" ng-click="toggleTalk()" ng-class="{active:talk}"></a></li>
         <li><a class="srtc-video" href="#" ng-click="toggleVideo()" ng-class="{active:video}"></a></li>
      </ul>
   </div>
</div>

<div class="cover-container">
   <div class="loading rtc-panel-raise animated bounceIn" ng-hide="initialized">
      <h1 class="">Loading...</h1>
   </div>
   <div class="cover rtc-panel-raise ng-hide animated fadeInDown" ng-show="initialized">
      <!--<span>Name: <input type="text" ng-model="userName"></span>-->
      <div sc-peer="peer" ng-repeat="(id,peer) in peers" class="rtc-panel-drop">{{id}}</div>
   </div>
</div>

<div class="mastfoot">
   <a class="srtc-social-github" href="#"></a>
   <a class="srtc-social-facebook" href="https://www.facebook.com/sococo"></a>
   <a class="srtc-social-linkedin" href="http://www.linkedin.com/company/sococo"></a>
   <a class="srtc-social-twitter" href="https://twitter.com/so_co_co"></a>
</div>

<!-- Define the angular app controller -->
<script type="text/javascript">
   function AppController($scope){
      $scope.localPeerId = '' + Math.floor(Math.random() * (1000000 - 5 + 1)) + 5;
      console.log("My peer is : " + $scope.localPeerId);
      $scope.peers = [];
      $scope.initialized = true;
      $scope.userName = "Unknown User";
      $scope.localVideo = null;
      var host = location.origin
         .replace(/^([a-zA-z]+):\/\//, '')
         .replace(/:(\d+)$/,":<%=pubsubport%>");
      $scope.localPeer = new Sococo.RTC.LocalPeerConnection({
         location:"rtc-demo",
         localId:$scope.localPeerId,
         serverUrl:host,
         serverMount:"<%=pubsubmount%>"
      });
      $scope.peers = $scope.localPeer.peers;

      // Tell Angular to update scope bindings.
      $scope.localPeer.on('addPeer removePeer',function() {
         $scope.$apply();
      });
      /* Toggle buttons for Listen/AudioShare/VideoShare */
      $scope.listen = true;
      $scope.talk = $scope.video = false;
      $scope.toggleListen = function(){
         $scope.listen = !$scope.listen;
         $scope.localPeer.properties.receiveAudio = $scope.listen;
         $scope.localPeer.dirtyProperties();
      };
      $scope.toggleTalk = function(){
         $scope.talk = !$scope.talk;
         $scope.localPeer.properties.sendAudio = $scope.talk;
         $scope.localPeer.dirtyProperties();
      };
      $scope.toggleVideo = function(){
         $scope.video = !$scope.video;
         $scope.localPeer.properties.sendVideo = $scope.video;
         $scope.localPeer.dirtyProperties();
      };
   }
</script>

<!-- Asynchronously load angular and the app. -->
<script type="text/javascript">
   /* Based on: http://jeremyhixon.com/snippet/loading-javascript-files-asynchronously/ */
   function loadScripts(urls,success){
      var toLoad = urls.slice(0);
      function _next(){
         if(toLoad.length === 0){
            return success && success();
         }
         var url = toLoad.shift();
         var script = document.createElement('script');
         script.src = url;
         script.async = !0;
         var head = document.getElementsByTagName('head')[0];
         script.onload = script.onreadystatechange = script.onerror = function(d){
            if (!script.readyState || script.readyState == 'loaded' || script.readyState == 'complete') {
               script.onerror = script.onload = script.onreadystatechange = null;
               head.removeChild(script);
               _next();
            }
         };
         head.appendChild(script);
      }
      _next();
   }
   window.onload = function() {
      loadScripts([
         "js/faye-browser-min.js",
         "js/adapter.js",
         "app/sococo-rtc.js",
         "//ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js"
      ]);
   };
</script>
</body>
</html>